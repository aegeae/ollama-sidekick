<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ollama Sidekick</title>
    <link rel="stylesheet" href="./popup.css" />
  </head>
  <body>
    <main class="app">
      <header class="topbar">
        <div class="title">
          Sidekick
          <span id="contextBadge" class="badge" hidden>Context off</span>
        </div>

        <div class="controls">
          <select id="modelSelect" class="model" aria-label="Model"></select>

          <button id="settingsBtn" class="miniBtn" type="button" title="Settings">
            Settings
          </button>

          <button
            id="ctxDrawerToggleBtn"
            class="iconBtn"
            type="button"
            aria-label="Toggle context preview"
            title="Context preview"
          >
            <svg class="iconSvg" viewBox="0 0 16 16" aria-hidden="true">
              <path
                d="M6 3l5 5-5 5"
                fill="none"
                stroke="currentColor"
                stroke-width="1.8"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
        </div>
      </header>

      <section class="body" aria-label="Chat history and thread">
        <aside class="sidebar" aria-label="Chats">
          <div class="sidebarTop">
            <button
              id="sidebarToggleBtn"
              class="iconBtn"
              type="button"
              aria-label="Collapse sidebar"
              title="Collapse"
            >
              <svg class="iconSvg" viewBox="0 0 16 16" aria-hidden="true">
                <path
                  d="M10.5 3.5 6 8l4.5 4.5"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>

            <button id="newChatBtn" class="miniBtn" type="button" title="New chat" aria-label="New chat">
              <svg class="iconSvg" viewBox="0 0 16 16" aria-hidden="true">
                <path
                  d="M8 3v10M3 8h10"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                />
              </svg>
              <span class="btnLabel">New chat</span>
            </button>

            <button id="newFolderBtn" class="miniBtn" type="button" title="New folder" aria-label="New folder">
              <svg class="iconSvg" viewBox="0 0 16 16" aria-hidden="true">
                <path
                  d="M2.8 5.2h4l1.2 1.4h5.2c.6 0 1 .4 1 1v5.2c0 .6-.4 1-1 1H2.8c-.6 0-1-.4-1-1V6.2c0-.6.4-1 1-1Z"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.2"
                  stroke-linejoin="round"
                />
              </svg>
              <span class="btnLabel">New folder</span>
            </button>
          </div>

          <input id="chatSearch" class="sidebarSearch" type="search" placeholder="Search chats…" />

          <div id="sidebarList" class="sidebarList" aria-label="Folders and chats"></div>
        </aside>

        <div
          id="sidebarSplitter"
          class="sidebarSplitter"
          role="separator"
          aria-orientation="vertical"
          aria-label="Resize sidebar"
          tabindex="0"
          title="Drag to resize"
        ></div>

        <div class="main">
          <div class="chatHeader" aria-label="Active chat controls">
            <div id="chatTitle" class="chatTitle">Chat</div>
            <div class="chatActions">
              <select id="chatFolderSelect" class="chatFolder" aria-label="Folder"></select>
              <button
                id="renameChatBtn"
                class="iconBtn"
                type="button"
                aria-label="Rename chat"
                title="Rename"
              >
                <svg class="iconSvg" viewBox="0 0 16 16" aria-hidden="true">
                  <path
                    d="M3 13h3l7-7-3-3-7 7v3Z"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.2"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M9.5 4.5 11.5 6.5"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.2"
                    stroke-linecap="round"
                  />
                </svg>
              </button>

              <button
                id="deleteChatBtn"
                class="iconBtn"
                type="button"
                aria-label="Delete chat"
                title="Delete"
              >
                <svg class="iconSvg" viewBox="0 0 16 16" aria-hidden="true">
                  <path
                    d="M3.5 5h9M6.2 5V3.8c0-.4.3-.8.8-.8h2c.4 0 .8.3.8.8V5"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.2"
                    stroke-linecap="round"
                  />
                  <path
                    d="M5.5 5.5v7c0 .6.4 1 1 1h3c.6 0 1-.4 1-1v-7"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.2"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M7 7.2v4.6M9 7.2v4.6"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.2"
                    stroke-linecap="round"
                  />
                </svg>
              </button>
            </div>
          </div>

          <section id="chat" class="chat" aria-label="Chat"></section>
        </div>

        <aside id="contextDrawer" class="contextDrawer" aria-label="Context preview" hidden>
          <div class="contextDrawerHeader">
            <div class="contextDrawerTitle">Context preview</div>
            <button id="ctxDrawerCloseBtn" class="iconBtn" type="button" aria-label="Close context preview" title="Close">
              <svg class="iconSvg" viewBox="0 0 16 16" aria-hidden="true">
                <path
                  d="M4 4l8 8M12 4 4 12"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.6"
                  stroke-linecap="round"
                />
              </svg>
            </button>
          </div>

          <div class="contextDrawerBody">
            <div class="contextDrawerControls" aria-label="Context controls">
              <label class="ctxToggle">
                <input id="ctxIncludeSelection" type="checkbox" />
                Selection
              </label>

              <label class="ctxToggle">
                <input id="ctxIncludeExcerpt" type="checkbox" />
                Excerpt
              </label>

              <label class="ctxBudget">
                Budget
                <input
                  id="ctxMaxChars"
                  class="ctxBudgetInput"
                  type="number"
                  inputmode="numeric"
                  min="500"
                  max="20000"
                  step="500"
                  aria-label="Context character budget"
                />
              </label>

              <span id="ctxBudgetMeta" class="ctxMeta" aria-live="polite"></span>
            </div>

            <div class="previewSection">
              <div class="previewLabel">Context</div>
              <pre id="ctxDrawerContext" class="previewPre" aria-label="Context preview"></pre>
            </div>

            <div class="previewSection">
              <div class="previewLabel">Final prompt</div>
              <pre id="ctxDrawerPrompt" class="previewPre" aria-label="Final prompt preview"></pre>
            </div>

            <div class="contextDrawerStatusRow">
              <span id="ctxDrawerStatus" class="modalStatus" aria-live="polite"></span>
            </div>
          </div>
        </aside>
      </section>

      <div id="resizeBar" class="resizeBar" title="Drag to resize">
        <div id="resizeGrip" class="resizeGrip" aria-hidden="true"></div>
      </div>

      <footer class="composer">
        <div class="composerBottom">
        <textarea
          id="prompt"
          class="prompt"
          rows="1"
          placeholder="Ask Ollama… (Enter to send, Shift+Enter for newline)"
        ></textarea>
        <button id="generateBtn" class="send" type="button" aria-label="Send" title="Send"></button>
        </div>
      </footer>

      <div id="output" class="srOnly" aria-live="polite"></div>

      <div id="settingsOverlay" class="modalOverlay" hidden>
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
          <div class="modalHeader">
            <div id="settingsTitle" class="modalTitle">Settings</div>
            <button id="settingsCloseBtn" class="miniBtn" type="button" aria-label="Close settings">Close</button>
          </div>

          <div class="modalBody">
            <label class="formLabel">
              Base URL
              <input id="settingsBaseUrl" class="formInput" placeholder="http://localhost:11434" />
            </label>

            <label class="formLabel">
              Default model
              <select id="settingsModelSelect" class="formSelect" aria-label="Default model"></select>
              <input
                id="settingsModelCustom"
                class="formInput"
                placeholder="Custom model name"
                hidden
              />
            </label>

            <label class="formLabel">
              Theme
              <select id="settingsTheme" class="formSelect">
                <option value="system">System</option>
                <option value="dark">Dark</option>
                <option value="light">Light</option>
              </select>
            </label>

            <label class="formLabel">
              Font
              <select id="settingsFontFamily" class="formSelect">
                <option value="jetbrainsMono">JetBrains Mono (bundled)</option>
                <option value="system">System UI</option>
                <option value="sans">Sans</option>
                <option value="serif">Serif</option>
                <option value="mono">Monospace</option>
              </select>
            </label>

            <label class="formLabel">
              Font size
              <input id="settingsFontSize" class="formInput" type="number" inputmode="numeric" min="11" max="20" step="1" />
            </label>

            <label class="formLabel">
              Conversation history storage
              <select id="settingsHistoryStorageMode" class="formSelect">
                <option value="local">Local (browser storage)</option>
                <option value="folder">Folder (export)</option>
              </select>
            </label>

            <label class="formLabel">
              Export format
              <select id="settingsHistoryExportFormat" class="formSelect">
                <option value="json">JSON (single file)</option>
                <option value="jsonl">JSONL (single file)</option>
                <option value="md">Markdown</option>
              </select>
            </label>

            <div id="settingsHistoryFolderRow" class="modalActions">
              <button id="settingsChooseHistoryFolderBtn" class="miniBtn" type="button">Choose folder…</button>
              <button id="settingsClearHistoryFolderBtn" class="miniBtn" type="button">Clear</button>
              <span id="settingsHistoryFolderStatus" class="modalStatus"></span>
            </div>

            <div class="modalActions">
              <button id="settingsExportHistoryBtn" class="miniBtn" type="button">Export now</button>
              <span id="settingsHistoryExportStatus" class="modalStatus" aria-live="polite"></span>
            </div>

            <div class="modalActions">
              <button id="settingsSaveBtn" class="miniBtn" type="button">Save</button>
              <button id="settingsCancelBtn" class="miniBtn" type="button">Cancel</button>
              <button id="settingsResetBtn" class="miniBtn" type="button">Reset</button>
              <span id="settingsStatus" class="modalStatus" aria-live="polite"></span>
            </div>
          </div>
        </div>
      </div>

    </main>

    <script type="module" src="./popup.ts"></script>
  </body>
</html>
